<div class="container-fluid page">
  <div class="row top-nav">
    <app-navbar class="col-lg-12"></app-navbar>
  </div>
  <div style="height: 8px;">
    <p-progressBar *ngIf="loading" class="customProgress " mode="indeterminate" [style]="{'height': '6px' }">
    </p-progressBar>
  </div>
  <div *ngIf="formInfo && formInfo.id" class="row content dashboard">
    <tabset class="tabset">
      <tab heading="Initiator Form Details" id="tab1" style="margin-top: -20px">
        <div class="col-lg-12 page-header">
          <nav>
            <div class="row">
              <ol class="breadcrumb col-lg-8">
                <li class="breadcrumb-item">
                  <a><i class="fa fa-home"></i></a>
                </li>
                <li class="breadcrumb-item"><a>Initiator Form Details </a></li>
              </ol>
            </div>
          </nav>
        </div>
        <div class="col-lg-12 in-box">
          <div class="card table-card">
            <div class="card-header">
              <div class="form-group row">
                <div class="col-lg-3 margin-bottom-50 font-weight-bold">
                  <p class="p   ">Requester Name</p>

                  <label class="label-text">{{
                    formInfo.requester_name
                    }}</label>
                </div>
                <div class="col-lg-3 margin-bottom-50 font-weight-bold">
                  <p class="p   ">ID:</p>

                  <label class="label-text">{{ formInfo.userable_id }}</label>
                </div>
                <div *ngIf="formInfo.renew_count" class="col-lg-3 margin-bottom-50 font-weight-bold">
                  <p class="p   ">Renewal Details:</p>
                  <label class="label-text">Renewed from id#{{ formInfo.renewed_from }}</label>
                </div>
                <div class="col-lg-3 margin-bottom-50 font-weight-bold">
                  <p class="p   ">Document Type:</p>
                  <label class="label-text">{{ formInfo.document_type }}</label>
                </div>

                <div class="col-lg-3 margin-bottom-50 font-weight-bold">
                  <p class="p   ">Priority</p>
                  <label class="label-text">{{ formInfo.priority }}</label>
                </div>
                <div class="col-lg-3 margin-bottom-50 font-weight-bold">
                  <p class="p   ">Name of Party 1:</p>
                  <label class="label-text">{{ formInfo.party_name }}</label>
                </div>
                <div *ngFor="let i of other_parties" class="col-lg-3 margin-bottom-50 font-weight-bold">
                  <p class="p   ">Name of Party {{i[i.length -1]}}:</p>
                  <label class="label-text">{{ formInfo[i] }}</label>
                </div>
                <div class="col-lg-3 margin-bottom-50 font-weight-bold">
                  <p class="p   ">Requested Date:</p>
                  <label class="label-text">{{ formInfo.request_date | date: 'dd/MM/yyyy' }}</label>
                </div>
                <div class="col-lg-3 margin-bottom-50 font-weight-bold">
                  <p class="p   ">Required Days:</p>
                  <label class="label-text">{{ formInfo.required_days }}</label>
                </div>
                <div class="col-lg-3 margin-bottom-50 font-weight-bold">
                  <p class="p   ">Complexity:</p>
                  <label class="label-text">{{ formInfo.complexity }}</label>
                </div>
                <div class="col-lg-3 margin-bottom-50 font-weight-bold">
                  <p class="p   ">Category:</p>
                  <label class="label-text">{{ formInfo.category }}</label>
                </div>
                <div class="col-lg-3 margin-bottom-50 font-weight-bold">
                  <p class="p   ">Required Date:</p>
                  <label class="label-text">{{ formInfo.required_date | date : 'dd/MM/yyyy' }}</label>
                </div>
                <div class="col-lg-3 margin-bottom-50 font-weight-bold">
                  <p class="p   ">Document Start Date:</p>
                  <label class="label-text">{{
                    formInfo.document_start_date | date: 'dd/MM/yyyy'
                    }}</label>
                </div>
                <div class="col-lg-3 margin-bottom-50 font-weight-bold">
                  <p class="p   "><span>Document End Date:</span></p>
                  <label class="label-text">{{
                    formInfo.document_end_date | date: 'dd/MM/yyyy'
                    }}</label>
                </div>
                <div class="col-lg-3 margin-bottom-50 font-weight-bold">
                  <p class="p   "><span>Authorised By:</span></p>
                  <label class="label-text">{{ formInfo.authorized_by }}</label>
                </div>
                <!-- <div class="col-lg-3 margin-bottom-50 font-weight-bold">
                  <p class="p   "><span>Authorised By:</span></p>
                  <label class="label-text">{{ formInfo.authorized_by }}</label>
                </div> -->
                <div class="col-lg-3 contact  margin-bottom-45   ">
                  <p class="p   "><span>Contact Details:</span></p>
                  <label class="label-text "><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16"
                      fill="currentColor" class="bi bi-phone" viewBox="0 0 16 16">
                      <path
                        d="M11 1a1 1 0 0 1 1 1v12a1 1 0 0 1-1 1H5a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1h6zM5 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h6a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2H5z" />
                      <path d="M8 14a1 1 0 1 0 0-2 1 1 0 0 0 0 2z" />
                    </svg>{{ contactDetails.mobile }}</label> <br>
                  <label class="label-text "><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16"
                      fill="currentColor" class="bi bi-envelope-open" viewBox="0 0 16 16">
                      <path
                        d="M8.47 1.318a1 1 0 0 0-.94 0l-6 3.2A1 1 0 0 0 1 5.4v.818l5.724 3.465L8 8.917l1.276.766L15 6.218V5.4a1 1 0 0 0-.53-.882l-6-3.2zM15 7.388l-4.754 2.877L15 13.117v-5.73zm-.035 6.874L8 10.083l-6.965 4.18A1 1 0 0 0 2 15h12a1 1 0 0 0 .965-.738zM1 13.117l4.754-2.852L1 7.387v5.73zM7.059.435a2 2 0 0 1 1.882 0l6 3.2A2 2 0 0 1 16 5.4V14a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V5.4a2 2 0 0 1 1.059-1.765l6-3.2z" />
                    </svg> {{ contactDetails.email }}</label>
                </div>
                <div class="col-lg-3 margin-bottom-50 font-weight-bold">
                  <p class="p   ">If recurring:</p>
                  <label class="label-text">{{ formInfo.if_recurring }}</label>
                </div>
                <div *ngIf="formInfo.if_recurring === 'yes'" class="col-lg-3 margin-bottom-50 font-weight-bold">
                  <p class="p   ">Agreement date:</p>
                  <label class="label-text">{{ formInfo.agreement_date | date : 'dd/MM/yyyy' }}</label>
                </div>
                <div class="col-lg-3 margin-bottom-50 font-weight-bold">
                  <p class="p   ">Attachment: <i>({{calcNumberOfAssets('legaldocs_dept') +
                      calcNumberOfAssets('legaldocs') }}) </i> </p>
                  <button style="height: 40px" (click)="filter('legaldocs_dept')" class="btn btn-submit">
                    Open
                  </button>
                </div>
                <!-- <div *ngIf="(f_state === 11 || f_state === 12 ) && (userRole === 'initiator' || userRole ==='hod2')"
                  class="col-lg-5 margin-bottom-45 font-weight-bold ">
                  <p class="p   "> CS Team Drafts <i>({{calcNumberOfAssets('legaldocs_drafts')}}) </i> <sup>*</sup></p>
                  <button style="height: 40px" (click)="filter('legaldocs_drafts')" class="btn btn-submit">
                    Open
                  </button>
                </div> -->
                <div *ngIf="(f_state === 14  ) && (userRole === 'hod1' || userRole === 'hod2')"
                  class="col-lg-3 margin-bottom-50 font-weight-bold">
                  <p class="p   "> CS Team Drafts <i>({{calcNumberOfAssets('legaldocs_drafts')}}) </i><sup>*</sup></p>
                  <button style="height: 40px" (click)="filter('legaldocs_drafts')" class="btn btn-submit">
                    Open
                  </button>
                </div>
                <!-- <div *ngIf="(f_state === 13 || f_state === 14 ) && (userRole === 'initiator')"
                  class="col-lg-3 margin-bottom-50 font-weight-bold">
                  <p class="p   "> CS Team Drafts <i>({{calcNumberOfAssets('legaldocs_drafts')}}) </i> <sup>*</sup>
                  </p>
                  <button style="height: 40px" (click)="filter('legaldocs_drafts')" class="btn btn-submit">
                    Open
                  </button>
                </div> -->
                <div *ngIf="f_state === 11 && userRole === 'initiator'"
                  class="col-lg-5 margin-bottom-45 font-weight-bold ">
                  <p class="p   "> Your remarks on CS Drafts <sup>*</sup></p>
                  <textarea [(ngModel)]="remarks" class="form-control" id="hod2_remark" rows="2"></textarea>
                </div>
                <div *ngIf="showStatusButtons" class="col-lg-5 margin-bottom-45 font-weight-bold ">
                  <p class="p   "> Your remarks <sup>*</sup></p>
                  <textarea [(ngModel)]="remarks" class="form-control" id="hod2_remark" rows="2"></textarea>
                </div>

                <div *ngIf="userRole === 'initiator' && f_state === 13"
                  class="col-lg-3 margin-bottom-50 font-weight-bold ">
                  <p class="p cs">Closure Document <sup>*</sup><i>({{this.files.length}}) </i></p>
                  <!-- <div class="custom-file">
                    <input type="file" class="custom-file-input" id="customFile" name="attached_doc" [multiple]="true"
                      [required]="true" #fileInput multiple (change)="uploadCDoc($event)" />
                    <label class="custom-file-label" for="customFile">
                      <i class="fa fa-cloud-upload"></i>
                      <span *ngIf="!files"> Select files</span>
                      <ng-template [ngIf]="files.length">
                        <span *ngFor="let fi of files"> | {{fi}} </span>
                      </ng-template>
                    </label>
                    <div class="invalid-feedback">
                      Please upload a valid file.
                    </div>
                  </div> -->
                  <div class="custom-file">
                    <input type="button" (click)='toggleUpload($event)' class="custom-file-input" />
                    <label class="custom-file-label" for="customFile">
                      <i class="fa fa-cloud-upload"></i>
                      <span *ngIf="!files" (click)="toggleUpload($event)"> Select files</span>

                    </label>
                  </div>
                </div>

                <div *ngIf="(userRole === 'initiator' || userRole === 'hod2') && f_state === 11"
                  class="col-lg-3 margin-bottom-50 font-weight-bold ">
                  <p class="p cs"> Reconsider with <i>(Optional)</i> attachment<i>({{this.files.length}})
                    </i></p>
                  <!-- <div class="custom-file">
                    <input type="file" class="custom-file-input" id="customFile" name="attached_doc" [multiple]="true"
                      [required]="true" #fileInput multiple (change)="uploadCDoc($event)" />
                    <label class="custom-file-label" for="customFile">
                      <i class="fa fa-cloud-upload"></i>
                      <span *ngIf="!files"> Select files</span>
                      <ng-template [ngIf]="files.length">
                        <span *ngFor="let fi of files"> | {{fi}} </span>
                      </ng-template>
                    </label>
                    <div class="invalid-feedback">
                      Please upload a valid file.
                    </div>
                  </div> -->
                  <!-- <button type="menu" class="btn-submit uploadbtn" (click)='toggleUpload($event)'>Attach
                    new</button> -->
                  <div class="custom-file">
                    <input type="button" (click)='toggleUpload($event)' class="custom-file-input" />
                    <label class="custom-file-label" for="customFile">
                      <i class="fa fa-cloud-upload"></i>
                      <span *ngIf="!files" (click)="toggleUpload($event)"> Select files</span>

                    </label>
                  </div>
                </div>

                <div *ngIf="userRole === 'hod2' && f_state === 2" class="col-lg-3 margin-bottom-50 font-weight-bold  ">
                  <p class="p   "> Select a CS Team member <sup>*</sup></p>
                  <select class="form-control" name="allotedCsMemberId" [(ngModel)]="allotedCsMemberId" required>
                    <option [ngValue]="null">---Please Select---</option>
                    <option *ngFor="let mem of csTeamMembers ; let i = index" value="{{mem.user_id}}"
                      [ngValue]="mem.user_id">
                      {{mem.firstname + " " + mem.lastname }}
                    </option>

                  </select>
                </div>
                <div *ngIf="f_state === 14 " class="col-lg-3 margin-bottom-50 font-weight-bold ">
                  <p class="p"> Attached Closure Doc <i>({{calcNumberOfAssets('legaldocs_signed_copy')}}) </i>
                    <sup>*</sup>
                  </p>
                  <button style="height: 40px" (click)="filter('legaldocs_signed_copy')" class="btn btn-submit">
                    Open
                  </button>
                </div>
              </div>
              <div class="col-lg-12 in-box" id="tableWrap" *ngIf="f_state >= 3"
                style="padding-left: 0; margin-right: 0; ">
                <app-table-ld *ngIf="remarkLog" [initialFormData]="formInfo" [remarkLogs]="remarkLog" [role]='userRole'
                  [fState]='f_state'>
                </app-table-ld>
              </div>
              <div style="margin-bottom: 20px" class="text-right mt-4 ">
                <button style="min-width: 100px" type="button" class="btn mx-2  btn-submit" id="_goback"
                  [routerLink]="['/history']">
                  Go Back

                </button>
                <button *ngIf="showStatusButtons " [disabled]="submit_process" (click)="changeFormStatus('app')"
                  class="btn mx-2  btn-submit">
                  Approve

                </button>
                <button *ngIf="showStatusButtons" [disabled]="submit_process" (click)="changeFormStatus('recon')"
                  class="btn mx-2  btn-submit">
                  Reconsider

                </button>
                <button *ngIf="showStatusButtons && f_state !== 12" [disabled]="submit_process"
                  (click)="changeFormStatus('rej')" class="btn mx-2  btn-submit">
                  Reject

                </button>
                <!-- draft stuff below -->
                <button *ngIf="f_state === 11 && (userRole ==='initiator' || userRole === 'hod2')"
                  [disabled]="submit_process" (click)="respondDraft('app')" class="btn mx-2  btn-submit">
                  Approve

                </button>
                <button *ngIf="f_state === 11 && (userRole ==='initiator' || userRole === 'hod2')"
                  [disabled]="submit_process" (click)="respondDraft('recon') ; attachClosureOrReconDoc(2)"
                  class="btn mx-2  btn-submit">
                  Reconsider

                </button>
                <button *ngIf="f_state === 12 && userRole ==='hod2'" (click)="respondDraft('rej')"
                  [disabled]="submit_process" class="btn mx-2  btn-submit">
                  Reject
                  <!-- closure -->
                </button>
                <button *ngIf="f_state === 13 && userRole ==='initiator'" (click)="attachClosureOrReconDoc()"
                  [disabled]="submit_process" class="btn mx-2  btn-submit">
                  Add Closure Doc

                </button>
              </div>
            </div>
          </div>
        </div>
      </tab>
      <p-dialog header="Attachments" [(visible)]="showFileModal" [style]="{width: '50vw'}">
        <div class="files-container">
          <div class='file-box' *ngFor="let file of filesToShow" (click)='onOpen(file)'>
            <i [ngClass]="getFileData(file).icon" style="color:#ff8800;" aria-hidden="true"></i>
            <span class="badge badge-pill badge-primary filename ">{{getFileData(file).name.substring(0,25)}}
            </span>
          </div>
        </div>
        <!-- <button style="height: 40px" (click)="onOpen('legaldocs_dept')" class="btn btn-submit">Open doc
        </button> -->
      </p-dialog>
      <p-dialog header="Upload" [(visible)]="showUploadModal" [style]="{width: '60vw'}">
        <p-fileUpload name="attachments[]" [showUploadButton]='true' [showCancelButton]='true' [files]="files"
          styleClass='upload-container' customUpload="true" (onSelect)='selectFiles($event)'
          (uploadHandler)="close($event, 1)" (onRemove)='removeFile($event)' multiple="true" maxFileSize="2500000">
        </p-fileUpload>
      </p-dialog>
    </tabset>

  </div>
</div>